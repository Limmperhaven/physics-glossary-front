/* globals window, modules, MathJax */
"use strict";

var defaultConfig = require('./MathJaxConfig').defaultConfig,
    hooks = require('./MathJaxHooks'),
    version = '2.7.5',
    loadMathJaxAsync = function (config) {
        if (!config) {
            config = defaultConfig;
        }

        config['AuthorInit'] = function () {
            MathJax.Hub.Register.StartupHook("TeX Jax Ready", function () {
                MathJax.InputJax.TeX.prefilterHooks.Add(hooks.prefilterHook);

                /**
                 * https://github.com/mathjax/MathJax-docs/wiki/Beveled-fraction-like-sfrac,-nicefrac-bfrac
                 */
                var MML = MathJax.ElementJax.mml,
                    TEX = MathJax.InputJax.TeX;

                TEX.Definitions.macros.bfrac = "myBevelFraction";

                TEX.Parse.Augment({
                    myBevelFraction: function (name) {
                        var num = this.ParseArg(name),
                            den = this.ParseArg(name);
                        this.Push(MML.mfrac(num,den).With({bevelled: true}));
                    }
                });

            });
        };

        window.MathJax = config;

        setTimeout(function () {
            var d = document, f = d.getElementsByTagName('script')[0], s = d.createElement('script');
            s.type = 'text/javascript';
            s.async = true;
            s.src = '//cdn.jsdelivr.net/npm/mathjax@' + version + '/MathJax.js?config=TeX-AMS-MML_HTMLorMML.js';
            f.parentNode.insertBefore(s, f);
        }, 1);
    };


if (typeof module !== 'undefined') {
    module.exports = {
        loadMathJaxAsync: loadMathJaxAsync
    }
}
